<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tela Inicial | Kitchen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="icon" type="image/png"
        href="https://png.pngtree.com/png-clipart/20220903/ourmid/pngtree-chef-restaurant-logo-png-image_6136204.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>

<body style="overflow: hidden; height: 100%;">


    <!--##################################################
        menu do site
    #####################################################-->
    <nav class="navbar bg-dark navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" onclick="toggleSection('menu')">
                <img src="https://png.pngtree.com/png-clipart/20220903/ourmid/pngtree-chef-restaurant-logo-png-image_6136204.png"
                    alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
                Kitchen Restaurant
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown" style="justify-content: end;">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" onclick="toggleSection('menu')">Menu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" onclick="toggleSection('history')">Histórico</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Pedidos
                        </a>
                        <ul class="dropdown-menu bg-dark">
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="toggleSection('updatePedidos')">Atualizar</a></li>
                            <li id="requestSave"><a class="dropdown-item" style="color: white;"
                                    onclick="openModal('pedidos')">Cadastrar</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Pratos
                        </a>
                        <ul class="dropdown-menu bg-dark">
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="toggleSection('updateProduct')">Atualizar</a></li>
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="openModal('plates')">Cadastrar</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Clientes
                        </a>
                        <ul class="dropdown-menu bg-dark">
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="toggleSection('updateClient')">Atualizar</a></li>
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="openModal('cliente')">Cadastrar</a></li>
                        </ul>
                    </li>
                    <li class="nav-item" id="requestCreate">
                        <a class="nav-link" onclick="openModal('pedidos')">Fazer
                            Pedido</a>
                    </li>
                </ul>
            </div>
        </div>
        <script>
            function openModal(modal) {
                var modal = document.getElementById(modal);
                modal.style.display = 'block';
            }

            function closeModal(modal) {
                var modal = document.getElementById(modal);
                modal.style.display = 'none';
                window.location.reload();
            }

            function toggleSection(sectionId) {
                const sections = document.querySelectorAll("main > section");
                sections.forEach((section) => {
                    section.style.display = "none";
                });

                const selectedSection = document.getElementById(sectionId);
                if (selectedSection) {
                    selectedSection.style.display = "block";
                }
            }
        </script>
    </nav>
    <!--##################################################
        menu do site
    #####################################################-->






    <!--##################################################
        telas de navegação do site
    #####################################################-->
    <main class="sections" style="width: 100%; height: 100%; overflow: auto;">
        <section id="menu" class="sections">
            <div class="container">
                <h1 class="text-center mt-5">Menu do Restaurante</h1>
            </div>
            <div class="row mt-4" id="menuList" style="justify-content: center;"></div>
        </section>
        <section id="history" class="sections">
        </section>
        <section id="updatePedidos" class="sections">
        </section>
        <section id="updateProduct" class="sections">
        </section>
        <section id="updateClient" class="sections">
        </section>
    </main>
    <!--##################################################
        telas de navegação do site 
    #####################################################-->






    <!--##################################################
        Modal de cadastro de pedidos
    #####################################################-->
    <div class="modal" id="pedidos" style="padding: 3%;">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <button class="btn btn-outline-secondary" onclick="closeModal('pedidos')">
                    <i class="fas fa-times"></i>
                </button>
                Preencha as informações para fazer o pedido
            </div>
            <div class="card-body">
                <div class="form-group" hidden>
                    <label for="index_request">Index:</label>
                    <input type="number" class="form-control" id="index_request" name="index_request" required>
                </div>

                <div class="form-group">
                    <label for="client_request">Cliente:</label>
                    <select class="form-control" id="client_request" name="client_request">
                    </select>
                </div>

                <div class="form-group">
                    <label for="product_request">Produto:</label>
                    <select class="form-control" id="product_request" name="product_request">
                    </select>
                </div>

                <div class="form-group">
                    <label for="quatity_request">Quantidade:</label>
                    <input type="number" class="form-control" id="quatity_request" name="quatity_request" required>
                </div>

                <div class="form-group">
                    <label for="observations_request">Observações:</label>
                    <textarea class="form-control" id="observations_request" name="observations_request"
                        rows="4"></textarea>
                </div>

                <button class="btn btn-primary" onclick="submitJsonrequests()">Enviar Pedido</button>
            </div>
            <script>
                function submitJsonrequests() {

                    // Obter os valores dos campos do formulário
                    var index_request = document.getElementById('index_request').value;
                    var client_request = document.getElementById('client_request').value;
                    var product_request = document.getElementById('product_request').value;
                    var quatity_request = document.getElementById('quatity_request').value.toString();
                    var observations_request = document.getElementById('observations_request').value;
                    observations_request = observations_request.replace(/\n/g, '*');

                    var jsonData;
                    if (!index_request) {
                        jsonData = {
                            type: "requests",
                            client_request: client_request,
                            product_request: product_request,
                            quantity_request: quatity_request,
                            observations_request: observations_request
                        };
                    } else {
                        var item = listOfJson[index_request];
                        jsonData = {
                            type: "requestUpdate",
                            old_client_request: item.client_request,
                            old_product_request: item.product_request,
                            old_quantity_request: item.quantity_request,
                            old_observations_request: item.observations_request,
                            old_hour_request: item.hour_request,
                            old_date_request: item.date_request,

                            client_request: client_request,
                            product_request: product_request,
                            quantity_request: quatity_request,
                            observations_request: observations_request
                        };
                    }
                    sendJsonToBack(jsonData)
                }
            </script>
        </div>
    </div>
    <!--##################################################
        Modal de cadastro de pedidos
    #####################################################-->



    <!--##################################################
        Modal de cadastro de clientes
    #####################################################-->
    <div class="modal" id="cliente" style="padding: 3%;">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <button class="btn btn-outline-secondary" onclick="closeModal('cliente')">
                    <i class="fas fa-times"></i>
                </button>
                Preencha as informações para cadastrar o cliente
            </div>
            <div class="card-body">
                <div class="form-group" hidden>
                    <label for="index_client">Index:</label>
                    <input type="number" class="form-control" id="index_client" name="index_client" required>
                </div>

                <div class="form-group">
                    <label for="name_client">Nome do Cliente:</label>
                    <input type="text" class="form-control" id="name_client" name="name_cliente" required>
                </div>

                <div class="form-group">
                    <label for="email_client">Email do Cliente:</label>
                    <input type="email" class="form-control" id="email_client" name="email_cliente" required>
                </div>

                <div class="form-group">
                    <label for="number_client">Numero do Cliente:</label>
                    <input type="number" class="form-control" id="number_client" name="number_client" required>
                </div>

                <button class="btn btn-primary" onclick="submitJsonClient()">Cadastrar Cliente</button>
            </div>
            <script>
                function submitJsonClient() {

                    // Obter os valores dos campos do formulário
                    const index_client = document.getElementById('index_client').value;
                    const nameCliente = document.getElementById('name_client').value;
                    const emailCliente = document.getElementById('email_client').value;
                    const number_client = document.getElementById('number_client').value.toString();

                    // Montar um objeto JSON com os valores
                    var jsonData;
                    if (!index_client) {
                        jsonData = {
                            type: "clients",
                            name_client: nameCliente,
                            email_client: emailCliente,
                            number_client: number_client
                        };
                    } else {
                        var item = listOfJson[index_client];
                        jsonData = {
                            type: "clientUpdate",
                            old_name_client: item.name_client,
                            old_email_client: item.email_client,
                            old_number_client: item.number_client,

                            name_client: nameCliente,
                            email_client: emailCliente,
                            number_client: number_client
                        };
                    }
                    sendJsonToBack(jsonData);
                }
            </script>
        </div>
    </div>
    <!--##################################################
        Modal de cadastro de clientes
    #####################################################-->



    <!--##################################################
        Modal de cadastro de plates
    #####################################################-->
    <div class="modal" id="plates" style="padding: 3%;">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <button class="btn btn-outline-secondary" onclick="closeModal('plates')">
                    <i class="fas fa-times"></i>
                </button>
                Preencha as informações para cadastrar um plate
            </div>
            <div class="card-body">
                <div class="form-group" hidden>
                    <label for="index_plate">Index:</label>
                    <input type="number" class="form-control" id="index_plate" name="index_plate" required>
                </div>

                <div class="form-group">
                    <label for="name_plate">Nome do Prato:</label>
                    <input type="text" class="form-control" id="name_plate" name="name_plate" required>
                </div>

                <div class="form-group">
                    <label for="picture_plate">Link da Foto do Prato:</label>
                    <input type="text" class="form-control" id="picture_plate" name="picture_plate" required>
                </div>

                <div class="form-group">
                    <label for="desciption_plate">Descrição do Prato:</label>
                    <textarea class="form-control" id="desciption_plate" name="desciption_plate" rows="4"
                        required></textarea>
                </div>

                <div class="form-group">
                    <label for="price_plate">Preço do Prato (R$):</label>
                    <input type="number" class="form-control" id="price_plate" name="price_plate" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="time_ready">Tempo Médio de Preparo (minutos):</label>
                    <input type="number" class="form-control" id="time_ready" name="time_ready" required>
                </div>

                <div class="form-group">
                    <label for="quantity_free">Quantidade Disponível:</label>
                    <input type="number" class="form-control" id="quantity_free" name="quantity_free" required>
                </div>

                <button class="btn btn-primary" onclick="submitJsonplate()">Cadastrar prato</button>

                <div class="form-group mt-3">
                    <label for="imagem_preview">Preview da Imagem:</label>
                    <img src="" id="imagem_preview" class="img-thumbnail" style="max-width: 100px; max-height: 100px">
                </div>
            </div>
            <script>
                function submitJsonplate() {
                    // Obter os valores dos campos do formulário
                    const index_plate = document.getElementById("index_plate").value;
                    const nameplate = document.getElementById('name_plate').value;
                    const fotoplate = document.getElementById('picture_plate').value;
                    const descricaoplate = document.getElementById('desciption_plate').value;
                    const precoplate = document.getElementById('price_plate').value.toString();
                    const tempoPreparo = document.getElementById('time_ready').value.toString();
                    const quantidadeDisponivel = document.getElementById('quantity_free').value.toString();

                    // Montar um objeto JSON com os valores
                    var jsonData;
                    if (!index_plate) {
                        jsonData = {
                            type: "plates",
                            name_plate: nameplate,
                            picture_plate: fotoplate,
                            desciption_plate: descricaoplate,
                            price_plate: precoplate,
                            time_ready: tempoPreparo,
                            quantity_free: quantidadeDisponivel
                        };
                    } else {
                        var item = listOfJson[index_plate];
                        jsonData = {
                            type: "plateUpdate",
                            old_name_plate: item.name_plate,
                            old_picture_plate: item.picture_plate,
                            old_desciption_plate: item.desciption_plate,
                            old_price_plate: item.price_plate,
                            old_time_ready: item.time_ready,
                            old_quantity_free: item.quantity_free,

                            name_plate: nameplate,
                            picture_plate: fotoplate,
                            desciption_plate: descricaoplate,
                            price_plate: precoplate,
                            time_ready: tempoPreparo,
                            quantity_free: quantidadeDisponivel
                        };
                    }
                    sendJsonToBack(jsonData);
                }

                // Função para atualizar a imagem de visualização
                document.getElementById('picture_plate').addEventListener('input', function () {
                    const imagemPreview = document.getElementById('imagem_preview');
                    const fotoplate = this.value;

                    // Atualize a imagem de visualização com o link informado
                    imagemPreview.src = fotoplate;
                });
            </script>
        </div>
    </div>
    <!--##################################################
        Modal de cadastro de plates
    #####################################################-->




    <!--##################################################
        Seção Javascript do site
    #####################################################-->
    <script>
        var listOfJson = [];
        function preparateJsonList(dateList) {
            if (dateList) {
                var dateJSON = dateList;
                if (dateList.indexOf("},{") !== -1) {
                    dateJSON = dateList.split("},{");
                    dateJSON = dateJSON.map(function (item, index) {
                        if (index === 0) {
                            return item + "}";
                        } else if (index === dateJSON.length - 1) {
                            return "{" + item;
                        } else {
                            return "{" + item + "}";
                        }
                    });
                    var dateList = dateJSON.map(function (item) {
                        return JSON.parse(item);
                    });
                } else {
                    if (!Array.isArray(dateList)) {
                        dateJSON = [JSON.parse(dateList)];
                    }

                    return dateJSON;
                }
            }

            return dateList
        }

        function renderRequests(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("updatePedidos").innerHTML = renderTable(dateList, true);
            }
        }

        function renderHistory(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("history").innerHTML = renderTable(dateList);
            }
        }

        function renderPlates(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("updateProduct").innerHTML = renderTable(dateList, true);
                document.getElementById("product_request").innerHTML = renderOptions(dateList);
                renderMenuList(dateList);
            }
        }

        function renderUsers(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("updateClient").innerHTML = renderTable(dateList, true);
                document.getElementById("client_request").innerHTML = renderOptions(dateList,true);
            }
        }

        function disableRequest(valor1 , valor2){
            if(!(valor1 || valor2)){
                document.getElementById("requestSave").style.display = "none";
                document.getElementById("requestCreate").style.display = "none";
            }
        }

        function renderOptions(dateList,client) {
            dateList = preparateJsonList(dateList);
            var optionlist = '';
            for (var i = 0; i < dateList.length; i++) {
                var option;
                if(client){
                    option = dateList[i].name_client;
                }else{
                    option = dateList[i].name_plate;
                }
                optionlist += '<option>' + option + '</option>';
            }
            return optionlist;
        }

        function renderTable(dateList, edit) {
            dateList = preparateJsonList(dateList);
            var table = '<table class="table table-striped table-responsive">';

            table += '<thead><tr>';
            for (var key in dateList[0]) {
                table += '<th>' + key + '</th>';
            }

            if (edit) {
                table += '<th>Editar</th>';
                table += '<th>Deletar</th>';
            }
            table += '</tr></thead>';

            table += '<tbody>';
            for (var i = 0; i < dateList.length; i++) {
                table += '<tr style="max-width:100%">';
                for (var key in dateList[i]) {
                    table += '<td>' + dateList[i][key] + '</td>';
                }
                if (edit) {
                    listOfJson.push(dateList[i]);
                    table += '<td><button class="btn btn-outline-secondary" onclick="editItem(' + (listOfJson.length - 1) + ')">Editar</button></td>';
                    table += '<td><button class="btn btn-outline-danger" onclick="deleteItem(' + (listOfJson.length - 1) + ')">Deletar</button></td>';
                }
                table += '</tr>';
            }
            table += '</tbody>';

            table += '</table>';
            return table;
        }


        function renderMenuList(dateList) {
            document.getElementById("menuList").innerHTML = "";
            dateList = preparateJsonList(dateList);
            for (var i = 0; i < dateList.length; i++) {
                var menuList = `
                    <div class="col-md-3" style="margin:2%;">
                        <div class="card">
                            <img src="${dateList[i]["picture_plate"]}" class="card-img-top" alt="${dateList[i]["picture_plate"]}">
                            <div class="card-body">
                                <h5 class="card-title">${dateList[i]["name_plate"]}</h5>
                                <p class="card-text">${dateList[i]["desciption_plate"]}</p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">R$: ${dateList[i]["price_plate"]}</li>
                                    <li class="list-group-item">Tempo: ${dateList[i]["time_ready"]}</li>
                                    <li class="list-group-item">Quantidade disponivel: ${dateList[i]["quantity_free"]}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById("menuList").innerHTML += menuList;
            }
        }

        function editItem(index) {
            var item = listOfJson[index];
            if (item.origin == "request") {
                document.getElementById('index_request').value = index;
                document.getElementById('client_request').value = item.client_request;
                document.getElementById('product_request').value = item.product_request;
                document.getElementById('quatity_request').value = item.quantity_request;
                document.getElementById('observations_request').value = item.observations_request.replace("*", "\n");
                openModal('pedidos');
            } else if (item.origin == "plate") {
                document.getElementById('index_plate').value = index;
                document.getElementById('name_plate').value = item.name_plate;
                document.getElementById('desciption_plate').value = item.desciption_plate;
                document.getElementById('picture_plate').value = item.picture_plate;
                document.getElementById('price_plate').value = item.price_plate;
                document.getElementById('quantity_free').value = item.quantity_free;
                document.getElementById('time_ready').value = item.time_ready;
                openModal('plates');
            } else if (item.origin == "client") {
                document.getElementById('index_client').value = index;
                document.getElementById('name_client').value = item.name_client;
                document.getElementById('email_client').value = item.email_client;
                document.getElementById('number_client').value = item.number_client;
                openModal('cliente');
            } else {
                alert("Não é permitido editar esse dado")
            }
        }

        function deleteItem(index) {
            var jsonData = listOfJson[index];
            jsonData.type = jsonData.origin + "Delete";
            if (jsonData) {
                sendJsonToBack(jsonData);
            }
        }


        function sendJsonToBack(jsonData) {
            // Enviar o objeto JSON em uma solicitação POST
            fetch("./", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonData)
            })
                .catch(error => {
                    console.error("Erro:", error);
                });

            window.location.reload();
        }
        toggleSection('menu')
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
    <!--##################################################
        Seção Javascript do site
    #####################################################-->
</body>

</html>