<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tela Inicial | Kitchen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="icon" type="image/png"
        href="https://png.pngtree.com/png-clipart/20220903/ourmid/pngtree-chef-restaurant-logo-png-image_6136204.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>

<body style="overflow-x:hidden; width: 100%;">


    <!--##################################################
        menu do site
    #####################################################-->
    <nav class="navbar bg-dark navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" onclick="toggleSection('menu')">
                <img src="https://png.pngtree.com/png-clipart/20220903/ourmid/pngtree-chef-restaurant-logo-png-image_6136204.png"
                    alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
                Kitchen Restaurant
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown" style="justify-content: end;">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" onclick="toggleSection('menu')">Menu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" onclick="toggleSection('espera')">Sala de Espera</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" onclick="toggleSection('history')">Histórico</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Pedidos
                        </a>
                        <ul class="dropdown-menu bg-dark">
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="toggleSection('updatePedidos')">Atualizar</a></li>
                            <li id="requestSave"><a class="dropdown-item" style="color: white;"
                                    onclick="openModal('pedidos')">Cadastrar</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Produtos
                        </a>
                        <ul class="dropdown-menu bg-dark">
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="toggleSection('updateProduto')">Atualizar</a></li>
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="openModal('Produtos')">Cadastrar</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Clientes
                        </a>
                        <ul class="dropdown-menu bg-dark">
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="toggleSection('updateClient')">Atualizar</a></li>
                            <li><a class="dropdown-item" style="color: white;"
                                    onclick="openModal('cliente')">Cadastrar</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item" id="requestCreate">
                        <a class="nav-link" onclick="openModal('pedidos')">Fazer
                            Pedido</a>
                    </li>
                </ul>
            </div>
        </div>
        <script>
            function openModal(modal) {
                var cliente = document.getElementById("Cliente").value;
                exibirAtendimento(cliente)
                var modal = document.getElementById(modal);
                modal.style.display = 'block';
                modalOpened = true;
            }

            function closeModal(modal) {
                var modal = document.getElementById(modal);
                modal.style.display = 'none';
                window.location.reload();
                modalOpened = false;
            }

            function toggleSection(sectionId) {
                // Salvando o sectionId no localStorage com a tag "page"
                localStorage.setItem('page', sectionId);

                const sections = document.querySelectorAll("main > section");
                sections.forEach((section) => {
                    section.style.display = "none";
                });

                const selectedSection = document.getElementById(sectionId);
                if (selectedSection) {
                    selectedSection.style.display = "block";
                }
            }
        </script>
    </nav>
    <!--##################################################
        menu do site
    #####################################################-->






    <!--##################################################
        telas de navegação do site
    #####################################################-->
    <main class="sections" style="width: 100%; height: 100%; overflow: auto;">
        <section id="menu" class="sections">
            <div class="container">
                <h1 class="text-center mt-5">Menu do Restaurante</h1>
            </div>
            <div style="width: 100%; height: auto; background-color: aliceblue;">
                <div class="container">
                    <h3 class="text-center mt-5">Pratos</h3>
                </div>
                <div class="row mt-4" id="platesList" style="justify-content: center;"></div>
            </div>
            <div style="width: 100%; height: auto; background-color: rgb(240, 255, 244);">
                <div class="container">
                    <h3 class="text-center mt-5">Bebidas</h3>
                </div>
                <div class="row mt-4" id="drinksList" style="justify-content: center;"></div>
            </div>
            <div style="width: 100%; height: auto; background-color: rgb(252, 240, 255);">
                <div class="container">
                    <h3 class="text-center mt-5">Sobremesas</h3>
                </div>
                <div class="row mt-4" id="dessertList" style="justify-content: center;"></div>
            </div>
        </section>
        <section id="espera" class="sections">
            <div class="row" style="display: flex; align-items: center; justify-content: center;">
                <div class="card col-10" style="
                    margin: 3%; 
                    padding: 5%; 
                    height: 300px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    background-color: aliceblue;">
                    <h1 class="h1" style="font-size: 180px;" id="senhaChamada">000</h3>
                        <button class="btn btn-outline-secondary" onclick="callItem()">Chamar o Próximo</button>
                </div>
                <div class="card col-6" style="margin: 3%; 
                    height: 300px; padding: 1%; overflow-y: auto;" id="tableOfPass">
                </div>
            </div>
        </section>
        <section id="history" class="sections">
        </section>
        <section id="updatePedidos" class="sections">
        </section>
        <section id="updateProduto" class="sections">
        </section>
        <section id="updateClient" class="sections">
        </section>
    </main>
    <!--##################################################
        telas de navegação do site 
    #####################################################-->






    <!--##################################################
        Modal de cadastro de pedidos
    #####################################################-->
    <div class="modal" id="pedidos" style="padding: 3%;">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <button class="btn btn-outline-secondary" onclick="closeModal('pedidos')">
                    <i class="fas fa-times"></i>
                </button>
                Preencha as informações para fazer o pedido
            </div>
            <div class="card-body">
                <div class="form-group" style="margin-top: 1%;" hidden>
                    <label for="index_request">Index:</label>
                    <input type="number" class="form-control" id="index_request" name="index_request" required>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <div class="row">
                        <label for="Cliente" class="col">Cliente:</label>
                        <label for="Cliente" class="col">Atendimento:</label>
                    </div>
                    <div class="row">
                        <div class="col">
                            <select class="form-control" id="Cliente" name="Cliente"
                                onchange="exibirAtendimento(this.value)" required>
                            </select>
                        </div>
                        <div class="col">
                            <input type="text" id="atendimento" class="form-control" placeholder="Atendimento" readonly>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1%;" id="Produto">
                    <div class="row">
                        <label for="Produto" class="col">Produto:</label>
                        <label for="Quantidade" class="col">Quantidade:</label>
                        <label for="Excluir" class="col-1" style="display: none;" id="ExcluirCol">Excluir:</label>
                        <label for="Quantidade" class="col-1"
                            style="display: flex; justify-content: center;">Valor:</label>
                    </div>
                    <div id="Produto_example">
                        <div class="row" style="margin-top: 1%;">
                            <div class="col">
                                <select class="form-control" name="Produto" id="Produto_example_select0"
                                    onchange="exibirValor(0)" required>
                                </select>
                            </div>
                            <div class="col">
                                <input type="number" class="form-control col-6" id="Quantidade_Produto0"
                                    name="Quantidade" onchange="exibirValor(0)" required>
                            </div>
                            <div class="col-1" id="ExcluirAqui" style="display: none;"></div>
                            <label id="Valor0" class="col-1" style="display: flex; justify-content: end;">R$
                                0.00</label>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <div class="row">
                        <label class="col" style="display: flex; justify-content: end;">Total:</label>
                        <label id="ValorTotal" class="col-1">R$ 0.00</label>
                    </div>
                </div>

                <div style="margin-top: 1%;">
                    <button class="btn btn-outline-secondary" onclick="addProduto('','',contadorDeItens)">Adicionar
                        Produto</button>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <label for="Observação">Observações:</label>
                    <textarea class="form-control" id="Observação" name="Observação" rows="4"></textarea>
                </div>

                <div style="display:flex; width: 100%; margin-top: 1%; align-items: center; justify-content: center;">
                    <button class="btn btn-outline-secondary" onclick="submitJsonrequests()">Enviar Pedido</button>
                </div>
            </div>
            <script>
                function submitJsonrequests() {
                    // Obter os valores dos campos do formulário
                    var index_request = document.getElementById('index_request').value;
                    var Cliente = document.getElementById('Cliente').value;
                    var Observação = document.getElementById('Observação').value;
                    var Atendimento = document.getElementById('atendimento').value;
                    var valorTotal = document.getElementById('ValorTotal').textContent.replace("R$ ", "");

                    // Dividir a Observação em uma lista usando a quebra de linha
                    var ObservaçãoLista = Observação.split('\n').map(item => item.trim());

                    // Obter os valores dos campos Produto e Quantidade
                    var ProdutoInputs = document.querySelectorAll("#Produto select[name='Produto']");
                    var Produto = Array.from(ProdutoInputs).map(input => input.value.trim());

                    var quantityInputs = document.querySelectorAll("#Produto input[name='Quantidade']");
                    var Quantidade = Array.from(quantityInputs).map(input => input.value.trim().toString());

                    // Validar se todos os campos estão preenchidos
                    if (!Cliente || valorTotal === "R$ 0.00" || Produto.length === 0 || Quantidade.length === 0
                        || Produto[0] === "" || Quantidade[0] === "") {
                        alert("Por favor, preencha todos os campos.");
                        return; // Impede a continuação da execução da função se houver campos vazios.
                    }


                    // Montar um objeto JSON com os valores
                    var jsonData;
                    if (!index_request) {
                        jsonData = {
                            type: "requests",
                            Cliente: Cliente,
                            Produto: Produto,
                            Quantidade: Quantidade,
                            Observação: ObservaçãoLista,
                            Preço: valorTotal,
                            Senha: "",
                            Atendimento: Atendimento
                        };
                    } else {
                        var item = listOfJson[index_request];
                        jsonData = {
                            type: "requestUpdate",
                            old_Cliente: item.Cliente,
                            old_Produto: item.Produto,
                            old_Quantidade: item.Quantidade,
                            old_Observação: item.Observação,
                            old_Hora: item.Hora,
                            old_Data: item.Data,
                            old_Senha: item.Senha,
                            old_Preço: item.Preço,
                            old_Atendimento: item.Atendimento,

                            Cliente: Cliente,
                            Produto: Produto,
                            Quantidade: Quantidade,
                            Observação: ObservaçãoLista, // Enviar Observação como uma lista
                            Preço: valorTotal,
                            Atendimento: Atendimento
                        };
                    }
                    sendJsonToBack(jsonData);
                }
            </script>
        </div>
    </div>
    <!--##################################################
        Modal de cadastro de pedidos
    #####################################################-->



    <!--##################################################
        Modal de cadastro de clientes
    #####################################################-->
    <div class="modal" id="cliente" style="padding: 3%;">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <button class="btn btn-outline-secondary" onclick="closeModal('cliente')">
                    <i class="fas fa-times"></i>
                </button>
                Preencha as informações para cadastrar o cliente
            </div>
            <div class="card-body">
                <div class="form-group" style="margin-top: 1%;" hidden>
                    <label for="index_client">Index:</label>
                    <input type="number" class="form-control" id="index_client" name="index_client" required>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <label for="Nome">Nome do Cliente:</label>
                    <input type="text" class="form-control" id="Nome" name="Nomee" required>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <label for="Email">Email do Cliente:</label>
                    <input type="email" class="form-control" id="Email" name="Emaile" required>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <label for="Numero">Numero do Cliente:</label>
                    <input type="number" class="form-control" id="Numero" name="Numero" required>
                </div>

                <div class="form-group" style="margin-top: 1%;">
                    <label for="Preferencial">Atendimento:</label>
                    <select class="form-control" name="Preferencial" id="Preferencial" required>
                        <option>Preferencial</option>
                        <option>Comum</option>
                    </select>
                </div>

                <div style="display:flex; width: 100%; margin-top: 1%; align-items: center; justify-content: center;">
                    <button class="btn btn-outline-secondary" onclick="submitJsonClient()">Cadastrar Cliente</button>
                </div>
            </div>
            <script>
                function submitJsonClient() {
                    // Obter os valores dos campos do formulário
                    const index_client = document.getElementById('index_client').value;
                    const nameCliente = document.getElementById('Nome').value;
                    const emailCliente = document.getElementById('Email').value;
                    const Numero = document.getElementById('Numero').value.toString();
                    const Preferencial = document.getElementById('Preferencial').value;

                    // Validar se todos os campos estão preenchidos
                    if (!nameCliente && !emailCliente && !Numero) {
                        // Se algum campo estiver vazio, exiba uma mensagem de erro ou realize a ação apropriada.
                        alert("Por favor, preencha todos os campos.");
                        return; // Impede a continuação da execução da função se houver campos vazios.
                    }

                    // Montar um objeto JSON com os valores
                    var jsonData;
                    if (!index_client) {
                        jsonData = {
                            type: "clients",
                            Nome: nameCliente,
                            Email: emailCliente,
                            Numero: Numero,
                            Classificação: Preferencial
                        };
                    } else {
                        var item = listOfJson[index_client];
                        jsonData = {
                            type: "clientUpdate",
                            old_Nome: item.Nome,
                            old_Email: item.Email,
                            old_Numero: item.Numero,
                            old_Classificação: item.Classificação,

                            Nome: nameCliente,
                            Email: emailCliente,
                            Numero: Numero,
                            Classificação: Preferencial
                        };
                    }
                    sendJsonToBack(jsonData);
                }

            </script>
        </div>
    </div>
    <!--##################################################
        Modal de cadastro de clientes
    #####################################################-->



    <!--##################################################
        Modal de cadastro de Produtos
    #####################################################-->
    <div class="modal" id="Produtos" style="padding: 3%;">
        <div class="card bg-dark text-white">
            <div class="card-header">
                <button class="btn btn-outline-secondary" onclick="closeModal('Produtos')">
                    <i class="fas fa-times"></i>
                </button>
                Preencha as informações para cadastrar um produto
            </div>
            <div class="row" style="padding: 3%;">
                <div class="col">
                    <div class="form-group" style="margin-top: 1%;" hidden>
                        <label for="index_Produto">Index:</label>
                        <input type="number" class="form-control" id="index_Produto" name="index_Produto" required>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Produto">Nome do Produto:</label>
                        <input type="text" class="form-control" id="ProdutoName" name="Produto" required>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Origem">Tipo de Produto:</label>
                        <select class="form-control" id="Origem" name="Origem" required>
                            <option value="plates">Prato</option>
                            <option value="drinks">Bebida</option>
                            <option value="dessert">Sobremesas</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Foto">Link da Foto do Produto:</label>
                        <input type="text" class="form-control" id="Foto" name="Foto" required>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Descrição">Descrição do Produto:</label>
                        <textarea class="form-control" id="Descrição" name="Descrição" rows="4" required></textarea>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Preço">Preço do Produto (R$):</label>
                        <input type="number" class="form-control" id="Preço" name="Preço" step="0.2" required>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Tempo">Tempo Médio de Preparo (minutos):</label>
                        <input type="number" class="form-control" id="Tempo" name="Tempo" required>
                    </div>

                    <div class="form-group" style="margin-top: 1%;">
                        <label for="Quantidade">Quantidade:</label>
                        <input type="number" class="form-control" id="QuantidadeProduto" name="Quantidade" required>
                    </div>

                    <div
                        style="display:flex; width: 100%; margin-top: 1%; align-items: center; justify-content: center;">
                        <button class="btn btn-outline-secondary" onclick="submitJsonProduto()">Cadastrar
                            Produto</button>
                    </div>
                </div>

                <div class="col" style="display: flex; justify-content: center; height: auto; ">
                    <img src="" id="imagem_preview" class="rounded" style="width: 100%; height: auto;">
                </div>
            </div>
            <script>
                function submitJsonProduto() {
                    // Obter os valores dos campos do formulário
                    const index_Produto = document.getElementById("index_Produto").value;
                    const origemProduto = document.getElementById('Origem').value;
                    const nameProduto = document.getElementById('ProdutoName').value;
                    const fotoProduto = document.getElementById('Foto').value;
                    const descricaoProduto = document.getElementById('Descrição').value;
                    const precoProduto = document.getElementById('Preço').value.toString();
                    const tempoPreparo = document.getElementById('Tempo').value.toString();
                    const quantidadeDisponivel = document.getElementById('QuantidadeProduto').value.toString();

                    // Dividir a Observação em uma lista usando a quebra de linha
                    var ObservaçãoLista = descricaoProduto.split('\n').map(item => item.trim());


                    // Validar se todos os campos estão preenchidos
                    if (!index_Produto && !nameProduto && !fotoProduto &&
                        !precoProduto && !tempoPreparo && !quantidadeDisponivel) {
                        alert("Por favor, preencha todos os campos.");
                        return;
                    }

                    // Montar um objeto JSON com os valores
                    var jsonData;
                    if (!index_Produto) {
                        jsonData = {
                            type: "products",
                            Origem: origemProduto,
                            Produto: nameProduto,
                            Quantidade: quantidadeDisponivel,
                            Foto: fotoProduto,
                            Descrição: ObservaçãoLista,
                            Preço: precoProduto,
                            Tempo: tempoPreparo
                        };
                    } else {
                        var item = listOfJson[index_Produto];
                        jsonData = {
                            type: "productUpdate",
                            old_Quantidade: item.Quantidade,
                            old_Origem: item.Origem,
                            old_Produto: item.Produto,
                            old_Foto: item.Foto,
                            old_Descrição: item.Descrição,
                            old_Preço: item.Preço,
                            old_Tempo: item.Tempo,

                            Origem: origemProduto,
                            Quantidade: quantidadeDisponivel,
                            Produto: nameProduto,
                            Foto: fotoProduto,
                            Descrição: ObservaçãoLista,
                            Preço: precoProduto,
                            Tempo: tempoPreparo
                        };
                    }
                    sendJsonToBack(jsonData);
                }

                // Função para atualizar a imagem de visualização
                function updateImagePreview() {
                    const imagemPreview = document.getElementById('imagem_preview');
                    const fotoProduto = document.getElementById('Foto').value;

                    // Atualize a imagem de visualização com o link informado
                    imagemPreview.src = fotoProduto;
                }
                document.getElementById('Foto').addEventListener('input', updateImagePreview);
            </script>
        </div>
    </div>
    <!--##################################################
        Modal de cadastro de Produtos
    #####################################################-->




    <!--##################################################
        Seção Javascript do site
    #####################################################-->
    <script>
        var listOfJson = [];
        var contadorDeItens = 1;
        function preparateJsonList(dateList, order) {
            if (dateList) {
                var dateJSON = dateList;

                if (dateList.indexOf("},{") !== -1) {
                    dateJSON = dateList.split("},{");
                    dateJSON = dateJSON.map(function (item, index) {
                        if (index === 0) {
                            return item + "}";
                        } else if (index === dateJSON.length - 1) {
                            return "{" + item;
                        } else {
                            return "{" + item + "}";
                        }
                    });

                    dateJSON = dateJSON.map(function (item) {
                        try {
                            // Tenta fazer o parse do JSON
                            return JSON.parse(item);
                        } catch (error) {
                            // Se falhar, retorna um objeto vazio
                            return {};
                        }
                    });

                } else {
                    try {
                        if (!Array.isArray(dateList)) {
                            dateJSON = [JSON.parse(dateList)];
                        }
                    } catch (error) {
                        // Se falhar, retorna um array vazio
                        return [];
                    }
                }

                // Remove objetos vazios do array
                dateJSON = dateJSON.filter(function (item) {
                    return Object.keys(item).length > 0;
                });

                // Ordena o array por "Data" e "Hora" se os campos existirem
                if (dateJSON.length > 0 && 'Data' in dateJSON[0] && 'Hora' in dateJSON[0] && order) {
                    dateJSON.sort(function (b, a) {
                        var dateComparison = a.Data.localeCompare(b.Data);
                        return dateComparison !== 0 ? dateComparison : a.Hora.localeCompare(b.Hora);
                    });
                }

                return dateJSON;
            }

            return dateList;
        }


        function renderRequests(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("updatePedidos").innerHTML = renderTable(dateList, true, true);
                document.getElementById("tableOfPass").innerHTML = renderTable(dateList, false, true, false);
            }
        }

        function renderHistory(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("history").innerHTML = renderTable(dateList, false, false, true);
            }
        }

        function renderProducts(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("updateProduto").innerHTML = renderTable(dateList, true);
                document.getElementById("Produto_example_select0").innerHTML = renderOptions(dateList);
                renderMenuList(dateList);
            }
        }

        function renderUsers(dateList) {
            if (dateList && dateList.length > 0) {
                document.getElementById("updateClient").innerHTML = renderTable(dateList, true);
                document.getElementById("Cliente").innerHTML = renderOptions(dateList, true);
            }
        }

        function renderPassword(value) {
            document.getElementById("senhaChamada").innerHTML = value;
        }

        function disableRequest(valor1, valor2) {
            if (!(valor1 || valor2)) {
                document.getElementById("requestSave").style.display = "none";
                document.getElementById("requestCreate").style.display = "none";
            }
        }

        function renderOptions(dateList, client) {
            dateList = preparateJsonList(dateList);
            var optionlist = '';
            for (var i = 0; i < dateList.length; i++) {
                var option;
                if (client) {
                    option = dateList[i].Nome;
                } else {
                    option = dateList[i].Produto;
                }
                optionlist += '<option>' + option + '</option>';
            }
            return optionlist;
        }

        function renderTable(dateList, edit, passwordList, order) {
            dateList = preparateJsonList(dateList, order);

            // Defina a ordem desejada das colunas
            var columnOrder;
            if (dateList[0].Origem == "history") {
                columnOrder = ['Data', 'Hora', 'Senha', 'Cliente', 'Produto', 'Quantidade', 'Observação', 'Preço'];
            } if (dateList[0].Origem == 'request') {
                columnOrder = ['Senha', 'Cliente', 'Produto', 'Quantidade', 'Observação', 'Preço', 'Atendimento'];
            } if (dateList[0].Origem == 'client') {
                columnOrder = ['Nome', 'Email', 'Numero', 'Classificação'];
            } if (dateList[0].Origem == 'plates' || dateList[0].Origem == 'drinks' || dateList[0].Origem == 'dessert') {
                columnOrder = ['Origem', 'Produto', 'Descrição', 'Quantidade', 'Preço', 'Tempo'];
            } if (passwordList) {
                columnOrder = ['Senha', 'Cliente', 'Atendimento'];
            }

            // Itere sobre o array de ordem para construir as colunas
            var table = '<table class="table table-striped table-responsive">';

            table += '<thead><tr>';
            for (var i = 0; i < columnOrder.length; i++) {
                table += '<th>' + columnOrder[i] + '</th>';
            }

            if (edit) {
                table += '<th>Editar</th>';
                table += '<th>Deletar</th>';
            }
            table += '</tr></thead>';

            table += '<tbody>';
            for (var i = 0; i < dateList.length; i++) {
                table += '<tr>';

                // Itere sobre o array de ordem para construir as células da linha
                for (var j = 0; j < columnOrder.length; j++) {
                    var key = columnOrder[j];
                    table += '<td style="max-width:40%;">'; // Ajuste a largura máxima conforme necessário
                    if (Array.isArray(dateList[i][key])) {
                        for (var k = 0; k < dateList[i][key].length; k++) {
                            table += dateList[i][key][k] + '<br>';
                        }
                    } else {
                        table += dateList[i][key];
                    }
                    table += '</td>';
                }

                if (edit) {
                    listOfJson.push(dateList[i]);
                    table += '<td><button class="btn btn-outline-secondary" onclick="editItem(' + (listOfJson.length - 1) + ')">Editar</button></td>';
                    table += '<td><button class="btn btn-outline-danger" onclick="deleteItem(' + (listOfJson.length - 1) + ')">Deletar</button></td>';
                }
                table += '</tr>';
            }
            table += '</tbody>';

            table += '</table>';
            return table;
        }




        function renderMenuList(dateList) {
            dateList = preparateJsonList(dateList);
            for (var i = 0; i < dateList.length; i++) {
                var ProdutosList = "";
                ProdutosList += `
                    <div class="col-md-3" style="margin:2%;">
                        <div class="card" style="display:flex; justify-content:center; align-items: center; padding:1%;">`
                if (dateList[i]["Foto"]) {
                    ProdutosList += `<img src="${dateList[i]["Foto"]}" class="card-img-top" style="width:280px; height: auto;">`
                }
                ProdutosList += `<div class="card-body">`
                if (dateList[i]["Produto"]) {
                    ProdutosList += `<h5 class="card-title">${dateList[i]["Produto"]}</h5>`
                }
                if (dateList[i]["Descrição"]) {
                    ProdutosList += `<p class="card-text">${dateList[i]["Descrição"]}</p>`
                }
                ProdutosList += `<ul class="list-group list-group-flush">`
                if (dateList[i]["Preço"]) {
                    ProdutosList += `<li class="list-group-item">R$: ${dateList[i]["Preço"]}</li>`
                }
                if (dateList[i]["Tempo"]) {
                    ProdutosList += `<li class="list-group-item">Tempo: ${dateList[i]["Tempo"]}</li>`
                }
                if (dateList[i]["Quantidade"]) {
                    ProdutosList += `<li class="list-group-item">Quantidade disponivel: ${dateList[i]["Quantidade"]}</li>`
                }
                ProdutosList += `</ul></div></div></div>`;

                document.getElementById(dateList[i]["Origem"] + "List").innerHTML += ProdutosList;
            }
        }

        function editItem(index) {
            var item = listOfJson[index];
            if (item.Origem == "request") {
                document.getElementById('index_request').value = index;
                document.getElementById('Cliente').value = item.Cliente;
                document.getElementById("Produto_example_select0").value = item.Produto[0];
                document.getElementById('Quantidade_Produto0').value = item.Quantidade[0];
                exibirValor(0);
                for (let i = 1; i < item.Produto.length; i++) {
                    addProduto(item.Produto[i], item.Quantidade[i], i);
                    exibirValor(i);
                }
                for (let i = 0; i < item.Observação.length; i++) {
                    if (i > 0) {
                        document.getElementById('Observação').value += "\n";
                    }
                    document.getElementById('Observação').value += item.Observação[i];
                }
                openModal('pedidos');
            } else if (item.Origem == "client") {
                document.getElementById('index_client').value = index;
                document.getElementById('Nome').value = item.Nome;
                document.getElementById('Email').value = item.Email;
                document.getElementById('Numero').value = item.Numero;
                openModal('cliente');
            } else {
                document.getElementById('index_Produto').value = index;
                document.getElementById('ProdutoName').value = item.Produto;
                document.getElementById('Descrição').value = item.Descrição;
                document.getElementById('Foto').value = item.Foto;
                document.getElementById('Preço').value = item.Preço;
                document.getElementById('QuantidadeProduto').value = item.Quantidade;
                document.getElementById('Tempo').value = item.Tempo;
                updateImagePreview();
                openModal('Produtos');
            }
        }

        function deleteItem(index) {
            var jsonData = listOfJson[index];
            if (jsonData.Origem == "plates" || jsonData.Origem == "drinks" || jsonData.Origem == "dessert") {
                jsonData.type = "productDelete";
            } else {
                jsonData.type = jsonData.Origem + "Delete";
            }
            if (jsonData) {
                sendJsonToBack(jsonData);
            }
        }

        function callItem(index) {
            var jsonData = {};
            jsonData.type = "callPass";
            if (jsonData) {
                sendJsonToBack(jsonData);
            }
        }


        function sendJsonToBack(jsonData) {
            // Enviar o objeto JSON em uma solicitação POST
            fetch("./", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonData)
            })
                .catch(error => {
                    console.error("Erro:", error);
                });

            window.location.reload();
        }

        function addProduto(ProdutoValue, quantityValue, index) {
            const ProdutoExample = document.getElementById("Produto_example");
            const newProdutos = ProdutoExample.cloneNode(true);
            const ProdutosList = document.getElementById("Produto");

            // Adicionando botão de exclusão
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Excluir";
            deleteButton.style.width = "100%";
            deleteButton.style.maxHeight = "40px";
            deleteButton.className = "btn btn-outline-secondary";
            deleteButton.addEventListener("click", function () {
                ProdutosList.removeChild(newProdutos);
                checkAndHideDeleteButton();
                contadorDeItens--;
                atualizarValorTotal();
            });

            const selectElement = newProdutos.querySelector("#Produto_example_select0");
            const quantityInput = newProdutos.querySelector("#Quantidade_Produto0");
            const valorLabel = newProdutos.querySelector("#Valor0");

            selectElement.value = ProdutoValue;
            quantityInput.value = quantityValue;

            selectElement.id = "Produto_example_select" + index;
            quantityInput.id = "Quantidade_Produto" + index;
            valorLabel.id = "Valor" + index;

            // Use "onchange" em vez de "change"
            selectElement.onchange = function () {
                exibirValor(index);
            };

            quantityInput.onchange = function () {
                exibirValor(index);
            };

            selectElement.id = "Produto_example_select" + index;
            quantityInput.id = "Quantidade_Produto" + index;
            valorLabel.id = "Valor" + index;

            // Verifica se a quantidade de clones é menor ou igual à quantidade de opções em Produto_example_select0
            const optionCount = ProdutoExample.querySelectorAll('select option').length;
            const existingClones = ProdutosList.querySelectorAll('.produto-clone').length;

            if (existingClones < optionCount - 1) {
                // Adicionando o botão de exclusão no final da linha
                var newExcluir = newProdutos.querySelector("#ExcluirAqui");
                var oldExcluir = document.querySelector("#ExcluirAqui");
                var ExcluirCol = document.getElementById("ExcluirCol");
                newExcluir.style.display = "block";
                ExcluirCol.style.display = "block";
                oldExcluir.style.display = "block";
                newExcluir.appendChild(deleteButton);

                newProdutos.classList.add('produto-clone'); // Adiciona uma classe para identificar clones
                ProdutosList.appendChild(newProdutos);
                contadorDeItens++;
                atualizarValorTotal();
            } else {
                // Adicione aqui a lógica ou feedback para indicar que o limite foi atingido
                console.log("Limite de clones atingido. Não é possível adicionar mais.");
            }
        }



        function checkAndHideDeleteButton() {
            const ProdutosList = document.getElementById("Produto");
            var deleteButtons = ProdutosList.querySelectorAll("#ExcluirAqui button");

            if (deleteButtons.length == 0) {
                var oldExcluir = document.querySelector("#ExcluirAqui");  // Use uma classe
                var newExcluirCol = document.getElementById("ExcluirCol");
                newExcluirCol.style.display = "none";
                oldExcluir.style.display = "none";
            }
        }

        function exibirAtendimento(cliente) {
            var atendimento;
            // Encontrar o valor correspondente na lista de JSONs
            for (var i = 0; i < listOfJson.length; i++) {
                if (listOfJson[i].Nome === cliente) {
                    atendimento = listOfJson[i].Classificação;
                    break; // Sair do loop assim que encontrar o valor correspondente
                }
            }
            document.getElementById("atendimento").value = atendimento;
        }

        function exibirValor(index) {
            var selectElement = document.getElementById("Produto_example_select" + index).value;
            var quantidadeElement = document.getElementById("Quantidade_Produto" + index).value;
            var valorAtual = 0.00;

            // Encontrar o valor correspondente na lista de JSONs
            for (var i = 0; i < listOfJson.length; i++) {
                if (listOfJson[i].Produto === selectElement) {
                    valorAtual = listOfJson[i].Preço;
                    break; // Sair do loop assim que encontrar o valor correspondente
                }
            }

            // Calcular o valor total
            var valorTotal = parseFloat(valorAtual) * parseInt(quantidadeElement);

            // Verifica se valorTotal é um número antes de usar toFixed
            if (!isNaN(valorTotal)) {
                // Se for um número, formata com toFixed
                valorTotal = valorTotal.toFixed(2);
            } else {
                // Se não for um número, atribui '0.00' ou qualquer valor padrão desejado
                valorTotal = '0.00';
            }

            // Exibir o valor total na label com 2 casas decimais
            var labelElement = document.getElementById("Valor" + index);
            labelElement.innerHTML = "R$ " + valorTotal;

            // Atualizar a label valortotal
            atualizarValorTotal();
        }


        // Função para atualizar o valor total somando todos os labels de valor
        function atualizarValorTotal() {
            var valorTotal = 0.00;
            var numberOfProdutos = contadorDeItens - 1;

            for (var i = 0; i <= numberOfProdutos; i++) {
                var labelElement = document.getElementById("Valor" + i);
                var valorStr = labelElement.innerHTML.replace("R$ ", ""); // Remove o "R$ " do início
                valorTotal += parseFloat(valorStr);
            }

            // Verifica se valorTotal é um número antes de usar toFixed
            if (!isNaN(valorTotal)) {
                // Se for um número, formata com toFixed
                valorTotal = valorTotal.toFixed(2);
            } else {
                // Se não for um número, atribui '0.00' ou qualquer valor padrão desejado
                valorTotal = '0.00';
            }

            // Atualiza a label valortotal
            var valortotalElement = document.getElementById("ValorTotal");
            valortotalElement.innerHTML = "R$ " + valorTotal;
        }

        // Função para verificar o valor no localStorage e agir em conformidade
        function checkLocalStorage() {
            // Obtém o valor da tag "page" no localStorage
            const storedPage = localStorage.getItem('page');

            if (storedPage) {
                toggleSection(storedPage);
            } else {
                toggleSection('menu');
            }
        }

        // Variável para verificar se o modal está aberto
        let modalOpened = false;

        // Função para recarregar a página a cada segundo, exceto se o modal estiver aberto
        function reloadPage() {
            // Verifica se o modal está aberto
            if (!modalOpened) {
                // Recarrega a página
                window.location.reload();
            }
        }

        // Função para verificar a cada segundo
        function checkReload() {
            // Executa a função reloadPage a cada segundo
            setInterval(reloadPage, 5000);
        }

        // Função para ser executada ao abrir a página HTML
        function onPageLoad() {
            // Execute qualquer lógica adicional que você precise ao carregar a página
            console.log("Página carregada!");

            // Inicia a verificação de recarregamento
            checkReload();
        }

        // Chama a função ao abrir a página HTML
        document.addEventListener("DOMContentLoaded", onPageLoad);


        checkLocalStorage();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
    <!--##################################################
        Seção Javascript do site
    #####################################################-->
</body>

</html>